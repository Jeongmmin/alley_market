<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
	<mapper namespace="am.mapper.CustomerMapper">
	
<!-- 		<select id="productMainPage" resultType="am.dto.ProductDto">
			<![CDATA[
				SELECT
					product_pk, product_name, product_price, product_stock_cnt, product_store, product_detail
				FROM
					product
				ORDER BY
					product_pk DESC
			]]>
		</select>-->
		
			<!-- 210825 혜수: 메인에서 상품 리스트 보기-->
			<select id="productMainPage" resultType="am.dto.ProductDto">
		      <![CDATA[
		         SELECT
		            product_pk,
		            product_name, product_price
		         FROM
		            product
		         ORDER BY
		            product_pk DESC
		      ]]>
		   </select>
			
			
		<!-- 리뷰 보기 -->
		<select id="reviewRead" parameterType="int" resultType="am.dto.ReviewDto">
			<![CDATA[
				SELECT
					review_pk, board_category_pk, review_title, review_contents, review_score,
					create_id, product_pk, order_pk,
					DATE_FORMAT(create_date, '%Y.%m.%d %H:%i') AS create_date,
					DATE_FORMAT(update_date, '%Y.%m.%d %H:%i') AS update_date
				FROM
					review
				WHERE
					product_pk = #{productPk}
				AND
					deleted_yn = 'N'
				ORDER BY
					product_pk DESC
			]]>
		</select>
		
		<!-- 문의 보기 -->
		<select id="qnaRead" parameterType="int" resultType="am.dto.QnaDto">
			<![CDATA[
				SELECT
					qna_pk, board_category_pk, qna_title, qna_contents,
					create_id, product_pk, answer_contents, answer_yn,
					DATE_FORMAT(create_date, '%Y.%m.%d %H:%i') AS create_date
				FROM
					qna
				WHERE
					product_pk = 1
				AND
					deleted_yn = 'N'
				ORDER BY
					product_pk DESC
			]]>
		</select>
		
		<!-- 문의 등록 -->
		<insert id="qnaInsert" parameterType="am.dto.QnaDto">
			<![CDATA[				
				INSERT INTO
					qna (product_pk, qna_title, qna_contents, create_id, create_date)
				VALUES
					(1, #{qnaTitle}, #{qnaContents}, #{createId}, NOW())
			]]>
		</insert>
		
		<!-- 주문하기 - 상품정보 불러오기 -->
		<select id="orderProduct" parameterType="int" resultType="am.dto.ProductDto">
			<![CDATA[
				SELECT 
					a.product_pk, a.product_name, a.product_price, a.product_store, b.order_pk, b.order_cnt, b.order_sum, b.product_pk
				FROM 
					product as a
				JOIN 
					orders_detail as b
				ON 
					a.product_pk = b.product_pk
				AND
					b.order_pk = 1
			]]>
		</select>
		
		<!-- 주문하기 - 주문입력 -->
		<insert id="orderInsert" parameterType="am.dto.OrdersDto">
			<![CDATA[				
				INSERT INTO
					orders (order_pk, customer_pk, order_name, order_phone, zip, addr1, addr2, order_date)
				VALUES
					(#{orderPk}, 1, #{orderName}, #{orderPhone}, #{zip}, #{addr1}, #{addr2}, NOW())
			]]>
		</insert>

	</mapper>
	
	